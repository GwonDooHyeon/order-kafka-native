## ============================================
## 공통 환경변수 (YAML 앵커로 중복 제거)
## ============================================
#x-kafka-common-env: &kafka-common-env
#  KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181                                             # Zookeeper 연결 주소
#  KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: DOCKER_INTERNAL:PLAINTEXT,HOST_MAC:PLAINTEXT  # 리스너별 보안 프로토콜 (둘 다 암호화 없음)
#  KAFKA_INTER_BROKER_LISTENER_NAME: DOCKER_INTERNAL                                   # 브로커 간 통신에 사용할 리스너
#  KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 3                                           # __consumer_offsets 토픽 복제 계수
#
#services:
#  # ============================================
#  # Zookeeper - Kafka 클러스터 관리자
#  # Kafka 브로커들의 메타데이터와 상태를 관리합니다
#  # ============================================
#  zookeeper:
#    container_name: zookeeper
#    image: confluentinc/cp-zookeeper:7.9.0  # Apache Kafka 3.9 기반
#    ports:
#      - "2181:2181"                        # Zookeeper 클라이언트 연결 포트
#    environment:
#      ZOOKEEPER_CLIENT_PORT: 2181          # 클라이언트가 연결할 포트
#      ZOOKEEPER_TICK_TIME: 2000            # Zookeeper 기본 시간 단위 (밀리초)
#
#  # ============================================
#  # Kafka Broker - 메시지 브로커
#  # 실제로 메시지를 저장하고 전달하는 핵심 서비스
#  # ============================================
#  kafka-1:
#    depends_on:
#      - zookeeper                          # Zookeeper가 먼저 실행되어야 함
#    container_name: kafka-1
#    image: confluentinc/cp-kafka:7.9.0      # Apache Kafka 3.9 기반, kafka-clients:4.x 호환
#    ports:
#      - "9092:9092"                        # 호스트(로컬)에서 접근할 때 사용
#      - "29092:29092"                      # Docker 내부 컨테이너 간 통신용
#    environment:
#      <<: *kafka-common-env                # 공통 설정 가져오기
#      KAFKA_BROKER_ID: 1                   # 브로커 고유 ID
#      # 리스너: DOCKER_INTERNAL(컨테이너간), HOST_MAC(호스트에서 접근)
#      KAFKA_ADVERTISED_LISTENERS: DOCKER_INTERNAL://kafka-1:29092,HOST_MAC://localhost:9092
#
#  kafka-2:
#    depends_on:
#      - zookeeper
#    container_name: kafka-2
#    image: confluentinc/cp-kafka:7.9.0      # Apache Kafka 3.9 기반, kafka-clients:4.x 호환
#    ports:
#      - "9093:9093"                        # 호스트(로컬)에서 접근할 때 사용
#      - "29093:29093"                      # Docker 내부 컨테이너 간 통신용
#    environment:
#      <<: *kafka-common-env                # 공통 설정 가져오기
#      KAFKA_BROKER_ID: 2                   # 브로커 고유 ID
#      # 리스너: DOCKER_INTERNAL(컨테이너간), HOST_MAC(호스트에서 접근)
#      KAFKA_ADVERTISED_LISTENERS: DOCKER_INTERNAL://kafka-2:29093,HOST_MAC://localhost:9093
#
#  kafka-3:
#    depends_on:
#      - zookeeper
#    container_name: kafka-3
#    image: confluentinc/cp-kafka:7.9.0             # Apache Kafka 3.9 기반, kafka-clients:4.x 호환
#    ports:
#      - "9094:9094"                               # 호스트(로컬)에서 접근할 때 사용
#      - "29094:29094"                             # Docker 내부 컨테이너 간 통신용
#    environment:
#      <<: *kafka-common-env                       # 공통 설정 가져오기
#      KAFKA_BROKER_ID: 3                          # 브로커 고유 ID
#      # 리스너: DOCKER_INTERNAL(컨테이너간), HOST_MAC(호스트에서 접근)
#      KAFKA_ADVERTISED_LISTENERS: DOCKER_INTERNAL://kafka-3:29094,HOST_MAC://localhost:9094

services:
  postgres:
    container_name: postgres
    image: postgres:17
    environment:
      POSTGRES_DB: orderdb
      POSTGRES_USER: order
      POSTGRES_PASSWORD: order1234
    ports:
      - "5432:5432"
    volumes:
      - postgres:/var/lib/postgresql/data

volumes:
  postgres:
