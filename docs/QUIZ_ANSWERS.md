# 퀴즈 정답 (학습 후 확인!)

> ⚠️ 스포일러 주의! 먼저 예상하고 코드를 작성한 후 확인하세요.

---

## Stage 1: 파티션 + 키

| 문제 | 정답 | 설명 |
|------|------|------|
| Q1 | **b** | 같은 키는 항상 같은 파티션으로 (해시 기반) |
| Q2 | **b** | null 키는 여러 파티션에 분배됨 (Sticky Partitioner) |
| Q3 | - | 해시 기반이라 실행해봐야 알 수 있음! 실습으로 확인하세요. |

---

## Stage 2: acks 설정

| 문제 | 정답 | 설명 |
|------|------|------|
| Q1 | **a** | acks=0은 확인 안 하므로 유실 가능 |
| Q2 | **a** | acks=1은 Leader만 확인, 복제 전 다운되면 유실 |
| Q3 | **b** | acks=0이면 메타데이터가 제대로 안 올 수 있음 |

---

## Stage 3: 재시도

| 문제 | 정답 | 설명 |
|------|------|------|
| Q1 | **b** | 재시도 중 순서 역전 가능! (in.flight > 1일 때) |
| Q2 | **a** | in.flight=1이면 순서 보장되나 성능 저하 |
| Q3 | **b** | Idempotent면 max 5까지 순서 보장 |

---

## Stage 4: 멱등성

| 문제 | 정답 | 설명 |
|------|------|------|
| Q1 | **b** | 브로커가 중복 감지하여 한 번만 저장 |
| Q2 | **a** | acks=all, retries=MAX, in.flight≤5로 자동 설정 |
| Q3 | **a** | 단일 Producer 세션 내에서만 보장 (재시작하면 새 PID) |

---

## Stage 5: 배치

| 문제 | 정답 | 설명 |
|------|------|------|
| Q1 | **a** | linger.ms=0이면 배치 없이 즉시 전송 |
| Q2 | **c** | batch.size나 linger.ms 둘 중 하나 만족시 전송 |
| Q3 | **b** | 배치가 안 차면 linger.ms까지 대기 |

---

## Stage 6: 압축

| 문제 | 정답 | 설명 |
|------|------|------|
| Q1 | **a** | gzip은 압축률 높고 느림, snappy는 빠르고 압축률 낮음 |
| Q2 | **b** | Consumer가 자동으로 압축 해제 (투명하게 처리) |
| Q3 | **b** | 배치로 모아서 보낼 때 압축 효과 극대화 |

---

## Stage 7: JSON

| 문제 | 정답 | 설명 |
|------|------|------|
| Q1 | **b** | Serializer로 바이트 배열 변환 필요 |
| Q2 | **a** | JSON 문자열로 보임 (StringDeserializer 사용시) |
| Q3 | **b** | Jackson의 `FAIL_ON_UNKNOWN_PROPERTIES=false` 설정 |

---

## Stage 8: 트랜잭션

| 문제 | 정답 | 설명 |
|------|------|------|
| Q1 | **a** | abort하면 모두 전달 안 됨 (원자성) |
| Q2 | **b** | console-consumer는 기본이 read_uncommitted라 보임! |
| Q3 | **b** | 새 Producer가 기존 것을 펜싱(zombie fencing) |

---

## Stage 9: Consumer 기본

| 문제 | 정답 | 설명 |
|------|------|------|
| Q1 | **c** | auto.offset.reset 설정에 따라 다름 (earliest/latest) |
| Q2 | **a** | 1초 동안 대기하며 메시지 수집 |

---

## Stage 10: Consumer Group

| 문제 | 정답 | 설명 |
|------|------|------|
| Q1 | **a** | Consumer1: 1개, Consumer2: 2개 파티션 담당 (또는 그 반대) |
| Q2 | **b** | 1개는 메시지를 받지 못한다 (파티션 수 < Consumer 수) |

---

## Stage 11: 수동 커밋

| 문제 | 정답 | 설명 |
|------|------|------|
| Q1 | **c** | 마지막 커밋된 오프셋부터 읽는다 (중복 가능) |
| Q2 | **a** | 해당 메시지를 다시 받을 수 있다 (at-least-once) |

---

## 핵심 개념 정리

### Producer 설정 트레이드오프

| 설정 | 성능 ↑ | 안정성 ↑ |
|------|--------|----------|
| acks | 0 | all |
| retries | 0 | MAX |
| linger.ms | 높음 | 낮음 |
| compression | snappy/lz4 | none |

### Consumer 보장 수준

| 패턴 | 설명 | 구현 |
|------|------|------|
| At-most-once | 유실 가능, 중복 없음 | 처리 전 커밋 |
| At-least-once | 유실 없음, 중복 가능 | 처리 후 커밋 |
| Exactly-once | 유실/중복 없음 | 트랜잭션 사용 |
